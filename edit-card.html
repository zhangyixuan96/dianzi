<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta http-equiv="X-UA-Compatible" content="ie=edge">
		<title></title>
		<script src="./js/global.js"></script>
		<script src="./js/vue.min.js"></script>
		<script src="./js/axios.min.js"></script>
		<script src="./js/iosSelect.js"></script>
		<script src="https://gosspublic.alicdn.com/aliyun-oss-sdk-4.4.4.min.js"></script>
		<link rel="stylesheet" href="./css/styles.css">
		<link rel="stylesheet" href="./css/iosSelect.css">
		<link rel="stylesheet" href="./css/cropper.min.css"/>
		<script src="./js/jquery-2.1.4.js"></script>
		<script src="./js/cropper.min.js"></script>
		<style>
			.container{width: 100%;height: 100%;position: fixed;}
			.canvas{/*width: 100%;*/height:95%;background-color: #000;}
			.canvas img{width: 100%;}
			.fade{width: 100%;height:20%;background-color: #000;}
			.btn_box{width: 60%;height:auto;margin: 0 auto;bottom: 0px;text-align: center;/*border: 1px solid red; */padding-top: 10%;}
			.btn_box div{color:#fff;width: 40%;font-size:34px;border: 1px solid #A09F9F;padding: 20px 10px;display: inline-block;text-align: center;padding: 10px 20px;}
			/* #cut{width: 2rem;height: 1rem;font-size: 0.5rem;color: black; background-color: white;}	 */
		</style>
	</head>

	<body>
		<div id="app" v-cloak>
			<div v-if="isNoCutImg">
			<header class="topbar">
				<!--<span class="fl" onClick="javascript:history.go(-1)">-->
				<span class="fl" @click="jumpTo('make-detail.html?id='+id)">
					
	            <img src="images/head_ic_back.png">
			</span>
				<!-- 编辑自制卡 -->
				<h2>{{language.edit_homemade_card}}</h2>
			</header>
			<div class="h88"></div>
			<div class="add-msg">
				<ul>
					<li>
						<span class="fl">{{language.card_number}}*</span>
						<span class="fr"><input type="text" :placeholder="language.please_fill_in" v-model="cardNumber" /></span>
						<div class="clearfix"></div>
						<span class="fr" @click="jumpTo('http:www.dzhyk.com/scan.html')">
	    				{{codewrite}}
	    				<img src="images/a4_ic_jump.png" alt="" class="first-img" />
	    			</span>
						<!--<span class="fr">
	    				<input type="text" placeholder="條形碼掃碼填入" />
	    				<img src="images/a4_ic_jump.png" alt="" class="first-img" />
	    			</span>-->
					</li>
					<li>
						<span class="fl">{{language.shop_name}}*</span>
						<span class="fr"><input type="text" :placeholder="language.please_fill_in" v-model="shopName" /></span>
					</li>
				</ul>
				<ul>
					
					<li>
						<span class="fl">{{language.effective_period}}</span>
						<span class="fr">
	    				<span @click="selValid">{{validTxt}}</span>
						<img src="images/a4_ic_jump.png" alt="" />
						</span>
					</li>
					<!--<li id="selinvalidTime">
						<span class="fl">有效期*</span>
						<span class="fr">
	    					<span data-year="" data-month="" data-date="" id="invalidTime" data-timetxt="" ref="invalidTime">{{timetxt}}</span>
							<img src="images/a4_ic_jump.png" alt="" />
						</span>
					</li>-->
					<li @click="typeSel">
						<span class="fl">{{language.business_type}}</span>
						<span class="fr">{{typeTxt}}<img src="images/a4_ic_jump.png" alt="" /></span>
					</li>
				</ul>
			</div>
			<div class="add-pics">
				<div class="tit">{{language.card_face_photo}}</div>
				<div class="add-pics-in">
					<ul>
						<li>
							<input type="file" accept="image/*" name="file" @change="upload($event)" v-if="appType == ''">
							<img src="images/a4_ic_add.png" v-if="frontImg=='' && appType == 'ios'" @click="iosUpload(1)" />
							<img src="images/a4_ic_add.png" v-else-if="frontImg=='' && appType == ''" />
							<img src="images/a4_ic_guan.png" alt="" class="icon-delete" v-if="frontImg!=''" @click="frontImg = ''" />
							<img :src="frontImg" alt="" v-if="frontImg!=''" />{{language.positive}}
						</li>
						<li>
							<input type="file" accept="image/*" name="file" @change="uploadBack($event)" v-if="appType == ''">
							<img src="images/a4_ic_add.png" v-if="backImg=='' && appType == 'ios'" @click="iosUpload(2)" />
							<img src="images/a4_ic_add.png" v-else-if="backImg=='' && appType == ''" />
							<img src="images/a4_ic_guan.png" alt="" class="icon-delete" v-if="backImg!=''" @click="backImg = ''" />
							<img :src="backImg" alt="" v-if="backImg!=''" />{{language.negative}}
						</li>
					</ul>
				</div>
			</div>
			<div class="btns">
				<div class="btn" @click="submit">{{language.confirm_add}}</div>
			</div>
		</div>
			<!-- 裁剪窗扣 -->
			<div class="container" v-else>
					<div>
							<header class="topbar">
									<span class="fl" @click="cutBack">
										<img src="images/head_ic_back.png">
									</span>
									<h2 class="mapTitle">裁剪</h2>
										<!-- 三个原点 -->
									<img class="three_circles" src="images/c_ic_merchants_05_s.png" id="cut">
							</header>
							<div class="h88"></div>
				
					</div>
				<!-- 展示选择的图片 -->
				<div class="canvas">
					<img id="image" src="" ref="myImg"/>
				</div>
				<!-- 预览裁剪的图片 -->
				<div style="height:20%;">
					<canvas id="canvas" style="border: 1px solid saddlebrown;"></canvas>
					<img src="" id="test" />
				</div>
			</div>
			<div class="pop-all" v-if="shopPop">
				<header class="topbar">
					<span class="fl" @click="cancle">
		            <img src="images/head_ic_back.png">
		        </span>
					<h2>{{language.select_a_business_type}}</h2>
				</header>
				<div class="h88"></div>
				<div class="shop-aside-nav">
					<ul>
						<li :class="{cur:firstId==item.id}" @click="nav(index,item.id,item.name)" v-for="(item,index) in items">{{item.name}}</li>
					</ul>
				</div>
				<div class="search-city-list">
					<dl>
						<dd :class="{cur:secondId == i.id}" v-for="i in secondClassificationDtoList" @click="selSecond(i.id,i.name)">{{i.name}}</dd>
					</dl>
				</div>
			</div>
			
			
			<div class="pop-all" v-if="validPop">
				<header class="topbar">
					<span class="fl" @click="cancle">
			            <img src="images/head_ic_back.png">
			        </span>
					<h2>{{language.annual}}</h2>
				</header>
				<div class="h88"></div>
				<div class="add-msg">
					<ul>
						<li>
							<span class="fl">{{language.indefinite}}</span>
							<span class="fr">
			    				<input type="radio" name="valid" value="1" v-model="type" @change="radChange" />
			    			</span>
						</li>
						<li>
							<span class="fl">{{language.valid_until_a_specific_date}}</span>
							<span class="fr">
			    				<input type="radio" name="valid" value="2" v-model="type" @change="radChange"/>
			    			</span>
						</li>
					</ul>
				</div>
				<div class="add-period clearfix" id="selinvalidTime" v-if="validBool">
					<span class="fr">
	    				<span data-year="" data-month="" data-ate="" id="invalidTime" data-timetxt="" ref="invalidTime">{{timeTxt}}</span>
						<img src="images/a4_ic_jump.png" alt="" />
					</span>
				</div>
			</div>
		</div>
		<script type="text/javascript">
			new Vue({
				mounted() {

					if(getUrlParam("id") != null && typeof(getUrlParam("id")) != "undefined") {
						this.id = getUrlParam("id");
					}
					this.getDetail();
					
					
					
				},
				el: "#app",
				data: { language:language,
					isNoCutImg:true,
					validTxt:language.please_choose,
					timeTxt:language.please_choose,
					type: "",
					validPop: false,
					validBool: false,
					invalidTime: "",
					cardNumber: "",
					shopName: "",
					secondClassificationId: "",
					frontImg: "",
					backImg: "",
					shopPop: false,
					items: [],
					firstId: "",
					secondId: "",
					id: "",
					secondClassificationDtoList: [],
					typeTxt: language.please_choose,
					firstName: "",
					secondName: "",
					timetxt: "",
					codewrite: language.barcode_scan_code_filling,


					
					
					client: {},
					uploadbaseUrl: "",
					appType: ""
				},
				methods: {
					
					//單選的改變
					radChange(){
						let vm = this;
						if(this.type == 1){
							this.validTxt = language.indefinite
							console.log(vm.validTxt);
							this.validBool = false;
							this.cancle();
						}else if(this.type == 2){
							this.validBool = true;
							setTimeout(function(){
								vm.selectTime("#invalidTime", "#selinvalidTime");	
							},20);
						}
					},
					//有效期選擇
					selValid() {
						let vm = this;
						this.validPop = true;
						if(this.type == 2){
							this.validBool = true;
							setTimeout(function(){
								vm.selectTime("#invalidTime", "#selinvalidTime");	
							},20);
						}
					},
					//取消
					cancle() {
						if(this.type == 2 && this.invalidTime == ""){
							this.type = 1;
							this.validBool = false;
						}
						this.shopPop = false;
						this.validPop = false;
					},
					
					iosUpload(type) {
						if(this.appType == "ios") {
							jumpTo("http://www.dzhyk.com/upload.html?appType=ios&cardNumber=" + this.cardNumber
							+"&shopName=" + this.shopName + "&invalidTime=" + this.invalidTime
							+"&typeTxt=" + this.typeTxt + "&frontImg=" + this.frontImg + "&backImg=" + this.backImg + "&firstId=" + this.firstId + "&secondId=" + this.secondId + "&type=" + type
							+"&validType=" + this.type + "&timeTxt=" + this.timeTxt + "&validTxt=" + this.validTxt
							+"&edit=true"+"&id="+this.id
							)
							return;
						}
					},
					//選擇分類點擊
					typeSel() {
						this.shopPop = true;
					},
					//側邊欄導航
					nav(i, id, name) {
						this.firstId = id;
						this.firstName = name;
						this.secondClassificationDtoList = this.items[i].secondClassificationDtoList;
					},
					//選擇二級分類
					selSecond(id, name) {
						this.secondName = name;
						this.shopPop = false;
						this.secondId = id;
						console.log(this.secondId);
						this.typeTxt = this.firstName + ">" + this.secondName;
					},
					// //上傳正面圖片
					// upload(e) {
					// 	let vm = this;
					// 	if(e.target.files) {
					// 		const fileLen = e.target.files
					// 		const resultUpload = [];
					// 		for(let i = 0; i < fileLen.length; i++) {
					// 			const file = fileLen[i];
					// 			const storeAs = new Date().getTime() + "K" + Math.floor(Math.random() * 100) + 9000;
					// 			let size = file.size;
					// 			vm.client.multipartUpload(storeAs, file, {

					// 			}).then((results) => {
					// 				if(size >= 100 * 1024) {
					// 					resultUpload.push(results.res.requestUrls[0].split("?")[0]);
					// 				} else {
					// 					resultUpload.push(results.url);
					// 				}
					// 			}).catch((err) => {
					// 				console.log(err);
					// 			});
					// 		}
					// 		vm.frontImg = resultUpload;
					// 		e.target.value = '';
					// 	} else {
					// 		e.target.value = '';
					// 	}
					// },
					// //上傳背面圖片
					// uploadBack(e) {
					// 	let vm = this;
					// 	if(e.target.files) {
					// 		const fileLen = e.target.files
					// 		const resultUpload = [];
					// 		for(let i = 0; i < fileLen.length; i++) {
					// 			const file = fileLen[i];
					// 			const storeAs = new Date().getTime() + "K" + Math.floor(Math.random() * 100) + 9000;
					// 			let size = file.size;
					// 			vm.client.multipartUpload(storeAs, file, {

					// 			}).then((results) => {
					// 				if(size >= 100 * 1024) {
					// 					resultUpload.push(results.res.requestUrls[0].split("?")[0]);
					// 				} else {
					// 					resultUpload.push(results.url);
					// 				}
					// 			}).catch((err) => {
					// 				console.log(err);
					// 			});
					// 		}
					// 		vm.backImg = resultUpload;
					// 		e.target.value = '';
					// 	} else {
					// 		e.target.value = '';
					// 		console.log(err);
					// 	}
					// },
					//上传正面图片
					upload(e) {
						console.log("e",e.target.files);
						
						let vm = this;
						vm.isloadBack = false;
						// alert(e.target.files.length);
						if(e.target.files) {
							const fileLen = e.target.files
							const resultUpload = [];
							for(let i = 0; i < fileLen.length; i++) {
								let file = fileLen[i];
								console.log("file",file);
								var reader = new FileReader();
								reader.readAsDataURL(file);
								reader.onload = (function(e) {
									//console.log(e.target.exif)
									var image = new Image();
									// console.log("e.target.result",e.target.result);
									let base64 = e.target.result;
									vm.isNoCutImg = false;
									vm.$nextTick(()=>{
										vm.getCutImg(base64);
									})
									// file = vm.dataURLtoFile(base64);
								})
								// const storeAs = new Date().getTime() + "K" + Math.floor(Math.random() * 100) + 9000;
								// let size = file.size;
								// // alert(storeAs)
								// // alert(file)
								// // console.log("storeAs",storeAs);
								// // console.log("file",file.name);
								// vm.client.multipartUpload(storeAs, file, {
								// }).then((results) => {
								// 	// alert("results",results)
								// 	console.log(results)
								// 	if(size >= 100 * 1024) {
								// 		resultUpload.push(results.res.requestUrls[0].split("?")[0]);
								// 	} else {
								// 		resultUpload.push(results.url);
								// 	}
								// }).catch((err) => {
								// 	alert(err)
								// 	console.log("err",err);
								// });
							}
							// alert("resultUpload",resultUpload)
							// vm.frontImg = resultUpload;
							e.target.value = '';
						} else {
							// alert("in2",);
							e.target.value = '';
						}
					},
					// 上传图片到服务器
					uploadImgToServer(file){
								const vm = this;
								let isloadBack = vm.isloadBack;
								const resultUpload = [];
								const storeAs = new Date().getTime() + "K" + Math.floor(Math.random() * 100) + 9000;
								let size = file.size;
								// alert(storeAs)
								// alert(file)
								// console.log("storeAs",storeAs);
								// console.log("file",file.name);
								vm.client.multipartUpload(storeAs, file, {
								}).then((results) => {
									// alert("results",results)
									// console.log(results)
									if(size >= 100 * 1024) {
										resultUpload.push(results.res.requestUrls[0].split("?")[0]);
									} else {
										resultUpload.push(results.url);
									}
									if(isloadBack){
										vm.backImg = resultUpload;
									}else{
										vm.frontImg = resultUpload;
									}
								}).catch((err) => {
									alert(err)
									console.log("err",err);
								});
					},
					// 将base64转化为文件类型
					dataURLtoFile (dataurl, filename = 'file') {
						let arr = dataurl.split(',')
						let mime = arr[0].match(/:(.*?);/)[1]
						let suffix = mime.split('/')[1]
						let bstr = atob(arr[1])
						let n = bstr.length
						let u8arr = new Uint8Array(n)
						while (n--) {
						u8arr[n] = bstr.charCodeAt(n)
						}
						return new File([u8arr], `${filename}.${suffix}`, {type: mime})
					},
					//上传背面图片
					uploadBack(e) {
						let vm = this;
						vm.isloadBack = true;
						if(e.target.files) {
							const fileLen = e.target.files
							const resultUpload = [];
							for(let i = 0; i < fileLen.length; i++) {
								const file = fileLen[i];
								var reader = new FileReader();
								reader.readAsDataURL(file);
								reader.onload = (function(e) {
									//console.log(e.target.exif)
									var image = new Image();
									// console.log("e.target.result",e.target.result);
									let base64 = e.target.result;
									vm.isNoCutImg = false;
									vm.$nextTick(()=>{
										vm.getCutImg(base64);
									})
									// file = vm.dataURLtoFile(base64);
								})
								// const storeAs = new Date().getTime() + "K" + Math.floor(Math.random() * 100) + 9000;
								// let size = file.size;
								// vm.client.multipartUpload(storeAs, file, {

								// }).then((results) => {
								// 	if(size >= 100 * 1024) {
								// 		resultUpload.push(results.res.requestUrls[0].split("?")[0]);
								// 	} else {
								// 		resultUpload.push(results.url);
								// 	}
								// }).catch((err) => {
								// 	console.log(err);
								// });
							}
							// vm.backImg = resultUpload;
							e.target.value = '';
						} else {
							e.target.value = '';
						}
					},
					//獲取壹級列表
					getList() {
						let vm = this;
						const url = baseUrl + '/app/common/getFirstClassificationDtoList.json';
						let formData = new FormData();
						axios.post(url, formData).then(res => {
							if(!goLogin(res.data, window.location.href)) {
								return;
							}
							if(res.data.code == 2000000) {
								vm.items = res.data.data;
								for(var i = 0; i < res.data.data.length; i++) {
									if(vm.firstId == res.data.data[i].id) {
										vm.secondClassificationDtoList = vm.items[i].secondClassificationDtoList;
									}
								}
							} else {
								warmHint(res.data.message);
							}
						});
					},
					//獲取詳情
					getDetail() {
						let vm = this;
						const url = baseUrl + '/app/appAccount/getSelfCardView.json';
						let formData = new FormData();
						formData.append('sessionId', sessionId);
						formData.append('selfCardId', vm.id);
						axios.post(url, formData).then(res => {
							if(!goLogin(res.data, window.location.href)) {
								return;
							}
							if(res.data.code == 2000000) {
								let data = res.data.data;
								vm.backImg = data.backImg;
								vm.cardNumber = data.cardNumber;
								vm.frontImg = data.frontImg;
								vm.shopName = data.shopName;
								//							vm.invalidTime = data.invalidTime;
								vm.firstId = data.firstClassificationId;
								vm.firstName = data.firstClassificationName
								vm.secondId = data.secondClassificationId
								vm.secondName = data.secondClassificationName;
								if(data.firstClassificationId == "" || data.firstClassificationId == 0){
									vm.typeTxt = language.please_choose;	
								}else{
									vm.typeTxt = vm.firstName + ">" + vm.secondName;
								}
								vm.getList();
								if(data.invalidTime != ""){
									vm.invalidTime = data.invalidTime.replace(new RegExp("/", "g"), "-");
									vm.timetxt = data.invalidTime.replace(new RegExp("/", "g"), "-");
								}
								vm.type = data.type;
								if(data.type == 1){
									vm.validTxt = language.indefinite;
								}else if(data.type == 2){
									vm.invalidTime = data.invalidTime.replace(new RegExp("/", "g"), "-");
									vm.validTxt = vm.invalidTime;
									vm.timeTxt = vm.invalidTime;
								}
//								vm.selectTime("#invalidTime", "#selinvalidTime");
								
								
								let formData = new FormData(); //通过 formdata上传
								axios.post(baseUrl + '/app/common/getAliOssMsg.json', formData).then(function(respone) {
									if(respone.data.code == 2000000) {
										vm.uploadbaseUrl = respone.data.data.baseUrl
										vm.client = new OSS.Wrapper({
											region: 'oss-cn-beijing',
											secure:true,
											accessKeyId: respone.data.data.accessKeyId,
											accessKeySecret: respone.data.data.accessKeySecret,
											bucket: respone.data.data.bucketName
										});
									}
								}).catch(function(error) {
									console.log(error);
								})
								
								
								
								if(typeof(getUrlParam("appType")) != "undefined" && getUrlParam("appType") != null) {
									vm.appType = "ios";
								}
								if(typeof(getUrlParam("shopName")) != "undefined" && getUrlParam("shopName") != null) {
									vm.shopName = getUrlParam("shopName");
									vm.timeTxt = getUrlParam("timeTxt");
									vm.validTxt = getUrlParam("validTxt");
									vm.invalidTime = getUrlParam("invalidTime");
									vm.typeTxt = getUrlParam("typeTxt");
									if(getUrlParam("type") == 1) {
										vm.frontImg = getUrlParam("imgUrl");
										vm.backImg = getUrlParam("backImg");
									} else if(getUrlParam("type") == 2) {
										vm.frontImg = getUrlParam("frontImg");
										vm.backImg = getUrlParam("imgUrl");
									}
									vm.firstId = getUrlParam("firstId");
									vm.secondId = getUrlParam("secondId");
									vm.type = getUrlParam("validType");
								}
			//					validType  timeTxt  validTxt
			
								if(typeof(getUrlParam("cardNumber")) != "undefined" &&  getUrlParam("cardNumber") != null) {
									vm.codewrite = language.rescan_code;
									vm.cardNumber = getUrlParam("cardNumber");
								}
							} else {
								warmHint(res.data.message);
							}
						});
					},
					submit() {
						let now = new Date(new Date().getFullYear(),(new Date().getMonth()),new Date().getDate(),0,0,0);
						
						
						if(this.cardNumber == "") {
							warmHint(language.please_fill_in_the_card_number);
							return;
						}
						if(this.shopName == "") {
							warmHint(language.please_fill_in_the_business_name);
							return;
						}
//						if(this.validTxt == language.please_choose) {
//							warmHint(language.please_select_a_valid_period);
//							return;
//						}
						
						if(this.type == 2) {
							if(this.invalidTime != "") {
								if(new Date(this.invalidTime).getTime() < now.getTime()) {
									warmHint(language.the_expiry_date_cannot_be_earlier_than_today);
									return;
								}
							}else if(this.invalidTime == "") {
								warmHint(language.please_select_a_specific_date_that_is_valid);
								return;
							}
						}
						
//						if(this.invalidTime == "") {
//							warmHint("請選擇有效期");
//							return;
//						}
//						if(this.typeTxt == "請選擇") {
//							warmHint("請選擇商戶類型");
//							return;
//						} 
						
//						if(this.frontImg == "") {
//							warmHint("請上傳正面");
//							return;
//						}
//						if(this.backImg == "") {
//							warmHint("請上傳反面");
//							return;
//						}
						let vm = this;
						const url = baseUrl + '/app/appAccount/updateSelfCard.json';
						let formData = new FormData();
						formData.append('sessionId', sessionId);
						formData.append('type', vm.type);
						if(vm.type == 2) {
							formData.append('invalidTime', vm.invalidTime);
						}
						formData.append('cardNumber', vm.cardNumber);
						formData.append('shopName', vm.shopName);
						formData.append('secondClassificationId', vm.secondId);
						formData.append('frontImg', vm.frontImg);
						formData.append('backImg', vm.backImg);
						formData.append('selfCardId', vm.id);
						axios.post(url, formData).then(res => {
							if(!goLogin(res.data, window.location.href)) {
								return;
							}
							if(res.data.code == 2000000) {
								warmHint(language.edit_success);
								setTimeout(function() {
									jumpTo("make-detail.html?id=" + vm.id);
								}, 2000)
							} else {
								warmHint(res.data.message);
							}
						});
					},
					//格式化时间
					formatYear(nowYear) {
						let arr = [];
						// - 5
						for(let i = nowYear; i <= nowYear + 60; i++) {
							arr.push({
								id: i + '',
								value: i + language.year
							});
						}
						return arr;
					},
					formatMonth() {
						let arr = [];
						for(let i = 1; i <= 12; i++) {
							arr.push({
								id: i + '',
								value: i + language.month
							});
						}
						return arr;
					},
					formatDate(count) {
						let arr = [];
						for(let i = 1; i <= count; i++) {
							arr.push({
								id: i + '',
								value: i + language.day
							});
						}
						return arr;
					},
					//五級選擇時間
					selectTime(childNode, parentNode) {
						const vm = this;
						let selectDateDom = document.querySelector(parentNode);
						let showDateDom = document.querySelector(childNode);
						// 初始化时间
						let now;
						if(this.invalidTime != "") {
							now = new Date(this.invalidTime);
						} else {
							now = new Date();
						}
						//			          console.log(now);return;
						let nowYear = now.getFullYear();
						let nowMonth = now.getMonth() + 1;
						let nowDate = now.getDate();
						showDateDom.setAttribute('data-year', nowYear);
						showDateDom.setAttribute('data-month', nowMonth);
						showDateDom.setAttribute('data-date', nowDate);

						let yearData = function(callback) {
							callback(vm.formatYear(nowYear))
						};
						let monthData = function(year, callback) {
							callback(vm.formatMonth());
						};
						let dateData = function(year, month, callback) {
							if(/^(1|3|5|7|8|10|12)$/.test(month)) {
								callback(vm.formatDate(31));
							} else if(/^(4|6|9|11)$/.test(month)) {
								callback(vm.formatDate(30));
							} else if(/^2$/.test(month)) {
								if(year % 4 === 0 && year % 100 !== 0 || year % 400 === 0) {
									callback(vm.formatDate(29));
								} else {
									callback(vm.formatDate(28));
								}
							} else {
								throw new Error('month is illegal');
							}
						};
						selectDateDom.addEventListener('click', function() {
							let oneLevelId = showDateDom.getAttribute('data-year');
							let twoLevelId = showDateDom.getAttribute('data-month');
							let threeLevelId = showDateDom.getAttribute('data-date');
							let iosSelect = new IosSelect(3, [yearData, monthData, dateData], {
								title: language.selection_period,
								itemHeight: 35,
								itemShowCount: 9,
								oneLevelId: oneLevelId,
								twoLevelId: twoLevelId,
								threeLevelId: threeLevelId,
								callback: function(selectOneObj, selectTwoObj, selectThreeObj) {
									showDateDom.setAttribute('data-year', selectOneObj.id);
									showDateDom.setAttribute('data-month', selectTwoObj.id);
									showDateDom.setAttribute('data-date', selectThreeObj.id);

									let newoneLevelId = showDateDom.getAttribute('data-year');
									let newtwoLevelId = showDateDom.getAttribute('data-month') >= 10 ? showDateDom.getAttribute('data-month') : 0 + showDateDom.getAttribute('data-month');
									let newthreeLevelId = showDateDom.getAttribute('data-date') >= 10 ? showDateDom.getAttribute('data-date') : 0 + showDateDom.getAttribute('data-date');
									showDateDom.innerHTML = newoneLevelId + "-" + newtwoLevelId + "-" + newthreeLevelId;
									vm.timeTxt = showDateDom.innerHTML;
									vm.validTxt = showDateDom.innerHTML;
									showDateDom.setAttribute('data-timetxt', showDateDom.innerHTML);
									vm.invalidTime = showDateDom.innerHTML
									
									vm.cancle();
								}
							});
						});
					},
					// 获取裁剪后的图片
					getCutImg(fileBase64){
					// console.log("fileBase64",fileBase64);
					const vm = this;
					var local = fileBase64;
					// var local = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAHgAAAB4CAYAAAA5ZDbSAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTggKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOjJCRTZGNzRBMzBDNjExRTlBRjU4QjkxREMyRTRGOEJGIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOjJCRTZGNzRCMzBDNjExRTlBRjU4QjkxREMyRTRGOEJGIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6MkJFNkY3NDgzMEM2MTFFOUFGNThCOTFEQzJFNEY4QkYiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6MkJFNkY3NDkzMEM2MTFFOUFGNThCOTFEQzJFNEY4QkYiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz7ZYFE5AAAK7klEQVR42uyd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';
					// var local = 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAL4AAAFACAYAAAACm8ZAAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTQyIDc5LjE2MDkyNCwgMjAxNy8wNy8xMy0wMTowNjozOSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo0RTczRDdCRjgxRTMxMUU5QTJCNEI1RjdDNDYxMUMyQyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo0RTczRDdDMDgxRTMxMUU5QTJCNEI1RjdDNDYxMUMyQyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjRFNzNEN0JEODFFMzExRTlBMkI0QjVGN0M0NjExQzJDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjRFNzNEN0JFODFFMzExRTlBMkI0QjVGN0M0NjExQzJDIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+rSWEoAAAFXNJREFUeNrs3V+sHOV5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'
					var $image = $("#image");  //裁剪区域要显示的图片
					// console.log("image",image);
					$image.attr("src",local); 
					$image.on("load", function() {// 等待图片加载成功后，才进行图片的裁剪功能
						// console.log("load");
						$image.cropper({
							// 裁剪比例
							aspectRatio: 2 / 1,
							// 定义cropper的视图模式
							viewMode:2,
							// 定义cropper的拖拽模式。
							dragMode:'move',
							// modal:false,
							// 在裁剪框上方显示白色的区域(突出裁剪框)
							highlight:false,
							// 是否允许旋转图像。
							rotatable:false,
							// 显示容器的网格背景。（就是后面的马赛克）
							background:false,
							// 是否可以通过拖动触摸来放大图像
							zoomOnTouch:false,
							// 显示在裁剪框上方的虚线。
							guides: false,  //裁剪框的虚线
							autoCropArea: 1,//0-1之间的数值，定义自动剪裁区域的大小，默认0.8
							dragCrop: false,//是否允许移除当前的剪裁框，并通过拖动来新建一个剪裁框区域
							// 是否允许可以移动后面的图片
							movable: true,  //是否允许移动剪裁框
							resizable: false,  //是否允许改变裁剪框的大小
							// 是否允许放大图像。
							zoomable: true,  //是否允许缩放图片大小
							// 是否可以通过拖动触摸来放大图像。							
							zoomOnTouch:true,
							mouseWheelZoom: false,  //是否允许通过鼠标滚轮来缩放图片
							touchDragZoom: true,  //是否允许通过触摸移动来缩放图片
							rotatable: false,  //是否允许旋转图片
							strict: true,
							toggleDragModeOnDblclick:false,
							// 是否通过拖动来调整剪裁框的大小。
							cropBoxResizable:true
						});
					});
					
					//裁剪 按钮
					$("#cut").on("click", function() {
						
						//方法一：通过cropper的getCroppedCanvas方法可以拿到一个画有剪裁图片的canvas。
						//但是测试后发现这种方法会导致裁剪的图片方法，需要进行比例缩放
		//			    var dataURL = $('#image').cropper("getCroppedCanvas");//拿到剪裁后的数据  
		//         		var data = dataURL.toDataURL("image/jpg", 1);//转成base64
		//			    alert("回调："+data);
						
						//方法二：通过cropper的getCanvasData和getCropBoxData方法获取到裁剪的一些数                据，再通过canvas的toDataURL转换裁剪的图片为base64
						var src = $image.attr("src");
						var canvasdata = $image.cropper("getCanvasData");
						var cropBoxData = $image.cropper('getCropBoxData');
						convertToData(src, canvasdata, cropBoxData, function(basechar) {
							let base64 = basechar;
							let file = vm.dataURLtoFile(base64);
							vm.uploadImgToServer(file);
							vm.isNoCutImg = true;
							// console.log("file",file);
							// 回调后的函数处理        
		//					alert("回调："+basechar);
		//					localStorage.setItem("basechar",basechar);
		//					location.href="test2.html";//预览base64
						});
					})
					
					//重新绘制裁剪的图片 转换为base64
					function convertToData(url, canvasdata, cropdata, callback) { 
						var cropw = cropdata.width; // 剪裁区域的宽度。
						var croph = cropdata.height; // 剪裁区域的高度
						var imgw = canvasdata.width; // canvas新的宽度
						var imgh = canvasdata.height; // canvas新的高度
		//			    alert(cropw+"，"+croph+"，"+imgw+"，"+imgh);
						var poleft = canvasdata.left - cropdata.left; // canvas定位图片的左边位置
						var potop = canvasdata.top - cropdata.top; // canvas定位图片的上边位置
		//			    alert(poleft+"，"+potop);
		//			    var canvas = document.createElement("canvas");//通过js创建canvas 但是页面看不到裁剪后的图片 需要自己拿到裁剪的base64后在显示出来
						var canvas = document.getElementById("canvas");//如果是本页面展示 可以在页面创建一个canvas 可以看到裁剪工具裁剪的图片
						var ctx = canvas.getContext('2d');
						
						canvas.width = cropw;
						canvas.height = croph;
						
					
						var img = new Image();
						img.src = url;	
						img.onload = function() {
							this.width = imgw;
							this.height = imgh;
							ctx.drawImage(this, poleft, potop, this.width,this.height);
							var base64 = canvas.toDataURL("image/jpg", 1);  // 这里的“1”是指的是处理图片的清晰度（0-1）之间，当然越小图片越模糊，处理后的图片大小也就越小
							callback && callback(base64)      // 回调base64字符串
						}
		
						img.onerror = function () {
							alert("error")
						}
					}
						},
						// 剪切返回
						cutBack(){
							this.isNoCutImg = true;
						}
				}
			});
		</script>
	</body>

</html>